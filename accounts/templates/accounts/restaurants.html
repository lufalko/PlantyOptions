{% extends 'accounts/main.html' %}
{% load static %}
{% block content %}

    <div id="restaurants_wrapper">

        <div id="restaurants_header">
            <div id="restaurants_searchbarIcon"></div>
            <div id="restaurants_searchbar"></div>
         </div>

        <div id="restaurants_body">
            <div id="restaurants_Adresseingabe_Headline_underline">
              <!--  <input type="text" placeholder="Adresse, i.e. Bahnhofsstraße 1"> -->
                <p id="restaurants_Adresseingabe_Headline">Adresse, i.e. Bahnhofsstraße 1</p>
            </div>
            <div id="restaurants_body_content">
                {% for i in restaurants %}

    <div class="restaurants_block">
    <div class="restaurants_img">
        {% ifequal i.restaurant_picture None %}
        <img src="{% static 'assets/dashboard-BG.jpg' %}">
        {% else %}
             <img src="{{i.restaurant_picture.url}}">
        {% endifequal %}

    </div>
    <div class="restaurants_name">
        <p>{{i.name}}</p>
    </div>
    <div class="restaurants_rating" >

        <p>{{i.rating}}</p>
    </div>
    <div class="restaurants_anzahl_vegetarisch">
         <img src="{% static 'assets/v_symbol.png' %}">
        <p>? vegetarische Gerichte</p>
        <div id="restaurants_anzahl_vegetarisch_underline"></div>
    </div>
    <div class="restaurants_anzahl_vegan">

        <img src="{% static 'assets/v_symbol.png' %}">
        <img src="{% static 'assets/v_symbol.png' %}">

        <p>? vegane Gerichte</p>

        <div id="restaurants_anzahl_vegan_underline"></div>

    </div>
    <div class="restaurants_adresse">
        <img src="{% static 'assets/PO_Icon_Green.png' %}">
        <p>{{i.location}}</p>
        <p>?km entfernt</p>
    </div>
        <div class="restaurant_dishes">
            {% for j in foods %}
            {% if j.restaurant == i %}
            <p>Gericht: </p>
            {{j.name}}
            {% endif %}
            {% endfor %}
        </div>
    </div>


{% endfor %}
        </div>
        </div>

        <div id="restaurants_aside_left">
            <div id="restaurants_filter">
                <form method="get">
                    {{myFilter.form}}
                    <div id="restaurants_stars">
                    </div>
                    <p id="restaurants_rating_reset" onclick="document.getElementById('id_rating').value = ' '; changeStars()" >reset</p>

                    <button class="btn btn-primary" type="submit">search</button>
                </form>
            </div>

            <div class="chrome">


            </div>

        </div>

        <a id="restaurants_aside_right" href="{% url 'map' %}">
        </a>

    </div>

  <div id="restaurants_background"> </div>






<script>

    let searchbarMinusWidth=30;

   function adaptSize(ele1, ele2, minusWidth , minusHeight) {
       if(typeof(minusWidth)==='undefined'){minusWidth = 0;}
        if(typeof(minusHeight)==='undefined'){minusHeight = minusWidth;}
       document.getElementById(ele1).style.width = document.getElementById(ele2).clientWidth - minusWidth + "px";
       document.getElementById(ele1).style.height = document.getElementById(ele2).clientHeight - minusHeight + "px";
   }

   window.addEventListener('resize', function() {
       adaptSize('restaurants_searchbar', 'restaurants_header',searchbarMinusWidth, 0);

   });

   adaptSize('restaurants_searchbar', 'restaurants_header', searchbarMinusWidth, 0);

   let classesNodeList = document.querySelectorAll(".restaurants_rating");
    let classes = Array.prototype.slice.call(classesNodeList).map(function(element) {
    return element.value;
});


   function stars() {

    for(let j = 0; j < classesNodeList.length; j++) {


        let SternArray = new Array(5);

        let TextInsideP = classesNodeList.item(j).getElementsByTagName('p')[0].innerHTML;

        if (TextInsideP == 0.0) {
            SternArray = [0, 0, 0, 0, 0];
        }
        if (TextInsideP == 1.0) {
            SternArray = [1, 0, 0, 0, 0];
        }
        if (TextInsideP == 2.0) {
            SternArray = [1, 1, 0, 0, 0];
        }
        if (TextInsideP == 3.0) {
            SternArray = [1, 1, 1, 0, 0];
        }
        if (TextInsideP == 4.0) {
            SternArray = [1, 1, 1, 1, 0];
        }
        if (TextInsideP == 5.0) {
            SternArray = [1, 1, 1, 1, 1];
        }

        for (let i = 0; i < SternArray.length; i++) {

            let element = document.createElement("img");

            if (SternArray[i] == 1) {
                element.setAttribute('src', "{% static 'assets/stern.png' %}");
            }

            if (SternArray[i] == 0) {
                element.setAttribute('src', "{% static 'assets/stern_leer.png' %}");
            }

            element.id = 'i';
            element.className = "stars_class";

            classesNodeList.item(j).appendChild(element);
        }
    }



}

    stars();

    document.getElementById("id_name").setAttribute("placeholder", "Name");
    document.getElementById("id_rating").setAttribute("placeholder", "Bewertung");
    document.getElementById("id_affordability").setAttribute("placeholder", "Preisklasse");


    var option = document.getElementById('id_tags').options;
 ;
    for(let i = 0; i < option.length; i++) {
        option[i].onclick = function () {
            if (this.myselected) {
                this.selected = false;
                this.myselected = false;

            } else {
                this.myselected = true;

            }
            ;
        };
    }

    window.onmousedown = function (e) {
    var el = e.target;
    if (el.tagName.toLowerCase() == 'option' && el.parentNode.hasAttribute('multiple')) {
        e.preventDefault();

        // toggle selection
        if (el.hasAttribute('selected')) el.removeAttribute('selected');
        else el.setAttribute('selected', '');

        // hack to correct buggy behavior
        var select = el.parentNode.cloneNode(true);
        el.parentNode.parentNode.replaceChild(select, el.parentNode);
    }
}


       function starrating() {

        let SternRatingArray = new Array(5);

        let rating = 0;
      ;

        if (rating == 0.0) {
            SternRatingArray = [0, 0, 0, 0, 0];

        for (let i = 0; i < SternRatingArray.length; i++) {

            let element = document.createElement("img");

            if (SternRatingArray[i] == 1) {
                element.setAttribute('src', "{% static 'assets/stern.png' %}");
            }

            if (SternRatingArray[i] == 0) {
                element.setAttribute('src', "{% static 'assets/stern_leer.png' %}");
            }

            element.id = 'rating_i';
            element.className = "stars_rating_class";

            document.getElementById('restaurants_stars').appendChild(element);
        }
    }}



    function changeStars() {

        let stars = document.getElementsByClassName('stars_rating_class');
        let star_amount = document.getElementById("id_rating").value;

        if (document.getElementById("id_rating").value == '') {
            document.getElementById("id_rating").value = 0;
        }

        for (let k = 0; k <= document.getElementById("id_rating").value - 1; k++) {
            stars[k].setAttribute('src', "{% static 'assets/stern.png' %}");

        }
        for (let k = document.getElementById("id_rating").value; k < 5; k++) {
            stars[k].setAttribute('src', "{% static 'assets/stern_leer.png' %}");
        }

        console.log(stars);
        for (let a = 0; a < stars.length; a++) {
            stars[a].addEventListener('click', function () {
                document.getElementById("id_rating").value = a + 1;
                for (let k = 0; k <= a; k++) {
                    stars[k].setAttribute('src', "{% static 'assets/stern.png' %}");
                    star_amount = a;
                }
                for (let k = a + 1; k < 5; k++) {
                    stars[k].setAttribute('src', "{% static 'assets/stern_leer.png' %}");
                }
            })
            stars[a].addEventListener('mouseover', function () {

                for (let k = 0; k <= a; k++) {
                    stars[k].setAttribute('src', "{% static 'assets/stern.png' %}");
                }
                for (let k = a + 1; k < 5; k++) {
                    stars[k].setAttribute('src', "{% static 'assets/stern_leer.png' %}");
                }
            })
            document.getElementById('restaurants_stars').addEventListener('mouseleave', function () {
                if (document.getElementById("id_rating").value == 0) {
                    for (let k = 0; k < 5; k++) {
                        stars[k].setAttribute('src', "{% static 'assets/stern_leer.png' %}");
                    }
                } else {
                    for (let k = 0; k <= star_amount; k++) {
                        stars[k].setAttribute('src', "{% static 'assets/stern.png' %}");

                    }
                    for (let k = star_amount + 1; k < 5; k++) {
                        stars[k].setAttribute('src', "{% static 'assets/stern_leer.png' %}");
                    }
                }
            })

        }
        if (document.getElementById("id_rating").value == 0) {
            document.getElementById("id_rating").value = ' ';
        }
    }




    starrating();
    changeStars();


    mapboxgl.accessToken = 'pk.eyJ1IjoiYW5uZWZsIiwiYSI6ImNraGdwNW4zdDA5M3cycnA2N2ZrZzlvaWsifQ.2Ax1R3zR3hTyr3CHwW73hQ';
         var map = new mapboxgl.Map({
            container: 'restaurants_aside_right',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [10.89779, 48.3705449],
            zoom: 12,
            bearing: 0
    });


</script>



{% endblock %}